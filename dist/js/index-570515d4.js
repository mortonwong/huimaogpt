import{b as Le}from"./vue-router-d1303c7c.js";import{s as De}from"./pinia-3307b5f3.js";import{h as ze}from"./html2canvas-18c4afc9.js";import{u as ue,i as Pe,d as ge,_ as M,a as he,t as g,b as Ee,c as se,e as Me,f as xe,s as Ne,g as Ke,h as je,j as qe,k as ve,l as me}from"./index-aea1435a.js";import{d as oe,c as U,Q as m,R as D,O as e,V as O,F as ee,h as Ve,Z as Fe,r as y,W as a,M as v,Y as F,$ as N,U as de,a0 as He,S as C,n as ae,j as ye,e as $,b as Ze,A as Je,X as We}from"./@vue-8ef811c2.js";import{q as ce,f as le,I as Ge,J as Qe,h as V,t as te,n as Xe,e as Ye,K as et}from"./naive-ui-3f1b3667.js";const tt="/png/avatar-8b55d978.png",ot=oe({__name:"Avatar",props:{image:{type:Boolean}},setup(o){const l=ue(),r=U(()=>l.userInfo.avatar);return(f,h)=>o.image?(m(),D(ee,{key:0},[e(Pe)(e(r))&&e(r).length>0?(m(),O(e(ce),{key:0,src:e(r),"fallback-src":e(ge)},null,8,["src","fallback-src"])):(m(),O(e(ce),{key:1,round:"",src:e(ge)},null,8,["src"]))],64)):(m(),O(e(ce),{key:1,round:"",src:e(tt)},null,8,["src"]))}}),nt=()=>({iconRender:l=>{const{color:r,fontSize:f,icon:h}=l,s={};return r&&(s.color=r),f&&(s.fontSize=`${f}px`),h||window.console.warn("iconRender: icon is required"),()=>Ve(M,{icon:h,style:s})}});function at(o){return new Promise((l,r)=>{try{const f=document.createElement("textarea");f.setAttribute("readonly","readonly"),f.value=o,document.body.appendChild(f),f.select(),document.execCommand("copy")&&document.execCommand("copy"),document.body.removeChild(f),l(o)}catch(f){r(f)}})}const st={style:{display:"flex","align-items":"baseline"}},lt={class:"flex flex-col"},rt={class:"transition text-neutral-300 hover:text-neutral-800 dark:hover:text-neutral-200"},it=oe({__name:"index",props:{dateTime:null,text:null,inversion:{type:Boolean},error:{type:Boolean},loading:{type:Boolean},showTooLong:{type:Boolean}},emits:["regenerate","delete"],setup(o,{emit:l}){const r=o,f=Fe(()=>Ee(()=>import("./Text-15189d33.js"),["js/Text-15189d33.js","js/markdown-it-e3a1182a.js","js/date-fns-9733c85e.js","js/uc.micro-740ead6f.js","js/mdurl-79eba04e.js","js/linkify-it-191b779c.js","js/punycode-3f09cc15.js","js/markdown-it-link-attributes-37292d98.js","js/highlight.js-f1ebc9d8.js","js/katex-eae73049.js","css/katex-df47a520.css","js/index-aea1435a.js","js/@vue-8ef811c2.js","js/naive-ui-3f1b3667.js","js/vooks-96993856.js","js/evtd-b614532e.js","js/vdirs-b0483831.js","js/treemate-25c27bff.js","js/seemly-411025cc.js","js/vueuc-ac5c3297.js","js/@css-render-09c3074c.js","js/@juggle-41516555.js","js/css-render-d3958e6a.js","js/@emotion-8a8e73f6.js","js/lodash-es-cabc0acd.js","js/pinia-3307b5f3.js","js/vue-router-d1303c7c.js","js/axios-760d4776.js","js/@vueuse-7b8e384e.js","js/vue-i18n-c69e1197.js","js/@intlify-7347860c.js","js/@iconify-e7ef2e7e.js","css/index-a3fcc681.css","js/html2canvas-18c4afc9.js","css/Text-f0f3af04.css"])),{isMobile:h}=he(),{iconRender:s}=nt(),i=le(),b=y(),k=y(r.inversion),x=y(),z=U(()=>{const R=[{label:g("chat.copy"),key:"copyText",icon:s({icon:"ri:file-copy-2-line"})},{label:g("common.delete"),key:"delete",icon:s({icon:"ri:delete-bin-line"})}];return r.inversion||R.unshift({label:k.value?g("chat.preview"):g("chat.showRawText"),key:"toggleRenderType",icon:s({icon:k.value?"ic:outline-code-off":"ic:outline-code"})}),R});function I(R){switch(R){case"copyText":L();return;case"toggleRenderType":k.value=!k.value;return;case"delete":l("delete")}}function B(){var R;(R=x.value)==null||R.scrollIntoView(),l("regenerate")}async function L(){try{await at(r.text||""),i.success("å¤åˆ¶æˆåŠŸ")}catch{i.error("å¤åˆ¶å¤±è´¥")}}const K=y(!0);function J(){K.value=!1}return(R,H)=>(m(),D("div",{ref_key:"messageRef",ref:x,class:F(["flex w-full mb-6 overflow-hidden messagemy",[{"flex-row-reverse":o.inversion}]])},[a("div",{class:F(["flex items-center justify-center flex-shrink-0 h-8 overflow-hidden rounded-full basis-8",[o.inversion?"ml-2":"mr-2"]])},[v(ot,{image:o.inversion},null,8,["image"])],2),a("div",{class:F(["text-base relative",[o.inversion?"items-end":"items-start"]])},[a("div",st,[N("",!0),a("p",{class:F(["text-xs text-[#b4bbc4]",[o.inversion?"text-right":"text-left"]])},de(o.dateTime),3),N("",!0)]),a("div",{class:F(["flex items-end gap-1 mt-2",[o.inversion?"flex-row-reverse":"flex-row"]])},[(m(),O(He(e(f)),{ref_key:"textRef",ref:b,inversion:o.inversion,error:o.error,text:o.text,loading:o.loading,"show-too-long":o.showTooLong,"as-raw-text":k.value,class:F(["dark:border-[transparent]",[o.inversion?"mySay":"gptSay"]]),onLoad:J},null,40,["inversion","error","text","loading","show-too-long","as-raw-text","class"])),K.value?(m(),O(e(Ge),{key:0,height:"40px",round:""})):N("",!0),a("div",lt,[o.inversion?N("",!0):(m(),D("button",{key:0,class:"mb-2 transition text-neutral-300 hover:text-neutral-800 dark:hover:text-neutral-300",title:"é‡æ–°å›ç­”",onClick:B},[v(e(M),{icon:"ri:restart-line"})])),v(e(Qe),{trigger:e(h)?"click":"hover",placement:o.inversion?"left":"right",options:e(z),onSelect:I},{default:C(()=>[a("button",rt,[v(e(M),{icon:"ri:more-2-fill"})])]),_:1},8,["trigger","placement","options"])])],2)],2)],2))}});function ct(){const o=y(null);return{scrollRef:o,scrollToBottom:async()=>{await ae(),o.value&&(o.value.scrollTop=o.value.scrollHeight)},scrollToTop:async()=>{await ae(),o.value&&(o.value.scrollTop=0)},scrollToBottomIfAtBottom:async()=>{await ae(),o.value&&o.value.scrollHeight-o.value.scrollTop-o.value.clientHeight<=100&&(o.value.scrollTop=o.value.scrollHeight)}}}function ut(){const o=se();return{addChat:(i,b)=>{o.addChatByUuid(i,b)},updateChat:(i,b,k)=>{o.updateChatByUuid(i,b,k)},updateChatSome:(i,b,k)=>{o.updateChatSomeByUuid(i,b,k)},getChatByUuidAndIndex:(i,b)=>o.getChatByUuidAndIndex(i,b),getChatData:()=>o.getChatData()}}function dt(){const o=le(),l=se(),r=U(()=>l.usingContext);function f(){l.setUsingContext(!r.value),r.value?o.success(g("chat.turnOnContext")):o.warning(g("chat.turnOffContext"))}return{usingContext:r,toggleUsingContext:f}}const pt={class:"mheader sticky top-0 left-0 right-0 z-30 dark:border-neutral-800 bg-white/80 dark:bg-[#000000b8] backdrop-blur"},ft={class:"relative flex items-center justify-between min-w-0 overflow-hidden h-11"},gt={class:"flex items-center"},vt=oe({__name:"index",props:{usingContext:{type:Boolean}},setup(o){const l=Me(),r=se(),f=U(()=>l.siderCollapsed),h=U(()=>r.getChatHistoryByCurrentActive);function s(){l.setSiderCollapsed(!f.value)}function i(){const b=document.querySelector("#scrollRef");b&&ae(()=>b.scrollTop=0)}return(b,k)=>{var x;return m(),D("header",pt,[a("div",ft,[a("div",gt,[a("button",{class:"flex items-center justify-center w-11 h-11",onClick:s},[e(f)?(m(),O(e(M),{key:0,class:"text-2xl",icon:"ri:align-justify"})):(m(),O(e(M),{key:1,class:"text-2xl",icon:"ri:align-right"}))])]),a("h1",{class:"flex-1 px-4 pr-6 overflow-hidden cursor-pointer select-none text-ellipsis whitespace-nowrap",onDblclick:i},de(((x=e(h))==null?void 0:x.title)??""),33)])])}}});const mt={class:"p-10 bg-white rounded dark:bg-slate-800"},ht={class:"space-y-4"},xt={class:"space-y-2",style:{position:"relative"}},yt=a("div",{style:{background:"linear-gradient(139deg, rgb(254 50 50) 10.79%, rgb(27 153 239) 87.08%)",color:"rgb(255, 255, 255)",position:"absolute",right:"68px","font-size":"0.9rem",top:"3px",width:"49px",height:"25px","text-align":"center","line-height":"25px","border-radius":"11px"}}," å…è´¹ ",-1),_t={class:"text-2xl font-bold text-center text-slate-800 dark:text-neutral-200",style:{"font-size":"1.8rem"}},wt=a("p",{class:"text-base text-center text-slate-500 dark:text-slate-500",style:{"font-size":"0.9rem","letter-spacing":"0.8px","font-weight":"600","margin-top":"4px"}},[$(" ğŸ¤–ä»¥ç»§ç»­å…è´¹å’Œæˆ‘å¯¹è¯"),a("br")],-1),Ct={style:{"text-align":"right","font-size":"0.8rem"}},bt=a("p",{class:"text-base text-center text-slate-500 dark:text-slate-500",style:{"font-size":"0.9rem","letter-spacing":"0.8px","font-weight":"600","margin-top":"4px"}},[$(" ğŸ‰ä»…å‰©ä¸€æ­¥ï¼å³å°†å’Œæˆ‘ç»§ç»­å¯¹è¯~"),a("br")],-1),kt=a("p",{class:"text-base text-center text-slate-500 dark:text-slate-500",style:{"font-size":"0.9rem","letter-spacing":"0.8px","font-weight":"600","margin-top":"4px"}},[$(" ğŸ‰ä»…å‰©ä¸€æ­¥ï¼å³å°†å’Œæˆ‘å¯¹è¯~"),a("br")],-1),Tt={style:{"text-align":"right","font-size":"0.8rem"}},St=oe({__name:"Permission",props:{visible:{type:Boolean}},emits:["canClose"],setup(o,{emit:l}){const r=ue(),f=xe(),h=y("register_step1");ye(()=>f.modalType,(n,c)=>{n&&(h.value=n)},{immediate:!0});const s=le(),i=y(!1);function b(n){n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),J())}function k(n){n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),H())}const x=y(""),z=y(""),I=y(""),B=y(""),L=y(""),K=y("");async function J(){if(!x.value){s.error("è¯·è¾“å…¥email");return}if(!R(x.value)){s.error("emailæ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·é‡æ–°è¾“å…¥");return}try{i.value=!0;const n=await Ne(x.value);s.success("å·²å‘é‚®ç®±å‘é€éªŒè¯ç ï¼Œè¯·æ³¨æ„æŸ¥æ”¶~"),K.value=n.SCC,console.log(K.value),h.value="register_step2"}catch(n){s.error(n.message??"error")}finally{i.value=!1}}function R(n){const c=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return console.log(c.test(n)),c.test(n)}async function H(){if(!/^\d{6}$/.test(z.value)){s.error("é‚®ç®±éªŒè¯ç æ ¼å¼é”™è¯¯ï¼Œåº”ä¸ºå…­ä½æ•°å­—");return}if(I.value!==B.value){s.error("ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€æ ·");return}if(!/^[A-Za-z0-9!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]{6,15}$/.test(I.value)){s.error("å¯†ç æ ¼å¼é”™è¯¯ï¼Œåº”è¯¥ä¸º6~15ä½æ•°å­—ã€å­—æ¯ã€å¸¸ç”¨ç¬¦å·çš„ä»»æ„ç»„åˆ");return}if(!/^[a-zA-Z0-9_\-.u4e00-\u9FA5]+$/.test(L.value)&&(L.value.length<2||L.value.length>20)){s.error("ç”¨æˆ·åæ ¼å¼é”™è¯¯ï¼Œåº”è¯¥ä¸º2~20ä¸ªå­—ç¬¦ä¹‹é—´çš„æ•°å­—ã€å­—æ¯ã€å¸¸ç”¨ç¬¦å·çš„ä»»æ„ç»„åˆ");return}try{i.value=!0,await Ke(x.value,z.value,L.value,I.value,K.value),s.success("æ³¨å†ŒæˆåŠŸï¼è‡ªåŠ¨ä¸ºæ‚¨ç™»é™†â€¦â€¦"),l("canClose",!0),r.updateUserInfo({name:L.value,isLogin:!0,vip:0})}catch(n){s.error(n.message??"error")}finally{i.value=!1}}function Q(n){h.value=n}const P=y(""),p=y(""),T=y("");async function W(){if(!P.value){s.error("è¯·è¾“å…¥ç”¨æˆ·åæˆ–Email");return}if(R(P.value))T.value="email";else if(/^[a-zA-Z0-9_\-.u4e00-\u9FA5]+$/.test(P.value)||P.value.length<2||P.value.length>20)T.value="username";else{s.error("è´¦å·æ ¼å¼é”™è¯¯ï¼Œè¯·è¾“å…¥ç”¨æˆ·åæˆ–Email");return}if(!/^[A-Za-z0-9!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]{6,15}$/.test(p.value)){s.error("å¯†ç æ ¼å¼é”™è¯¯ï¼Œåº”è¯¥ä¸º6~15ä½æ•°å­—ã€å­—æ¯ã€å¸¸ç”¨ç¬¦å·çš„ä»»æ„ç»„åˆ");return}try{i.value=!0;const n=await je(P.value,p.value,T.value);s.success(`ç™»å½•æˆåŠŸï¼æ¬¢è¿${n.userName}`),l("canClose",!0),r.updateUserInfo({name:n.userName,isLogin:!0,vip:0})}catch(n){s.error(n.message??"error")}finally{i.value=!1}}function A(){l("canClose",!0)}return(n,c)=>(m(),O(e(Xe),{show:o.visible,"auto-focus":!1,style:{width:"90%","max-width":"380px"},onMaskClick:A},{default:C(()=>[a("div",mt,[a("div",ht,[a("header",xt,[yt,a("h2",_t,de(h.value==="register_step1"||h.value==="register_step2"?"æ³¨å†Œ":"ç™»å½•"),1)]),h.value==="register_step1"?(m(),D(ee,{key:0},[wt,v(e(V),{value:x.value,"onUpdate:value":c[0]||(c[0]=w=>x.value=w),type:"text",size:"large",autofocus:!1,placeholder:"è¯·è¾“å…¥ç”µå­é‚®ç®±,å¦‚xxx@xxx.xxx",onKeypress:b},{prefix:C(()=>[$(" Email ")]),_:1},8,["value"]),a("div",Ct,[a("a",{style:{cursor:"pointer"},onClick:c[1]||(c[1]=w=>Q("login"))},"å·²æœ‰è´¦å·ï¼Œç«‹å³ç™»å½•->")]),v(e(te),{block:"",color:"#8a2be2",size:"large",loading:i.value,style:{"margin-top":"15px",background:"linear-gradient(327deg, rgb(97 115 255) 10.79%, rgb(239 27 225) 87.08%)",opacity:"1"},onClick:J},{default:C(()=>[$(" ä½¿ç”¨ç”µå­é‚®ç®±æ³¨å†Œ ")]),_:1},8,["loading"])],64)):N("",!0),h.value=="register_step2"?(m(),D(ee,{key:1},[bt,v(e(V),{value:z.value,"onUpdate:value":c[2]||(c[2]=w=>z.value=w),size:"large",placeholder:"Emailæ”¶åˆ°çš„6ä½æ•°å­—éªŒè¯ç ",onKeypress:k},{prefix:C(()=>[$(" éªŒè¯ç  ")]),_:1},8,["value"]),v(e(V),{value:L.value,"onUpdate:value":c[3]||(c[3]=w=>L.value=w),size:"large",placeholder:"è¯·è®¾ç½®ç”¨æˆ·å,å¯ä¸­æ–‡å¯è‹±æ–‡",onKeypress:k},{prefix:C(()=>[$(" ç”¨æˆ·å ")]),_:1},8,["value"]),v(e(V),{value:I.value,"onUpdate:value":c[4]||(c[4]=w=>I.value=w),size:"large",type:"password",placeholder:"è¯·è®¾ç½®å¯†ç ",onKeypress:k},{prefix:C(()=>[$(" å¯†ç  ")]),_:1},8,["value"]),v(e(V),{value:B.value,"onUpdate:value":c[5]||(c[5]=w=>B.value=w),size:"large",type:"password",placeholder:"è¯·å†æ¬¡è¾“å…¥å¯†ç ",onKeypress:k},{prefix:C(()=>[$(" å¯†ç  ")]),_:1},8,["value"]),v(e(te),{block:"",color:"#8a2be2",size:"large",loading:i.value,style:{"margin-top":"20px",background:"linear-gradient(327deg, rgb(97 115 255) 10.79%, rgb(239 27 225) 87.08%)",opacity:"1"},onClick:H},{default:C(()=>[$(" æ³¨å†Œå¹¶ç™»å½• ")]),_:1},8,["loading"])],64)):N("",!0),h.value==="login"?(m(),D(ee,{key:2},[kt,v(e(V),{value:P.value,"onUpdate:value":c[6]||(c[6]=w=>P.value=w),size:"large",placeholder:"è¯·è¾“å…¥ç”¨æˆ·åæˆ–Email",onKeypress:W},{prefix:C(()=>[$(" è´¦å· ")]),_:1},8,["value"]),v(e(V),{value:p.value,"onUpdate:value":c[7]||(c[7]=w=>p.value=w),size:"large",type:"password",placeholder:"è¯·è¾“å…¥å¯†ç ",onKeypress:W},{prefix:C(()=>[$(" å¯†ç  ")]),_:1},8,["value"]),a("div",Tt,[a("a",{style:{cursor:"pointer"},onClick:c[8]||(c[8]=w=>Q("register_step1"))},"æ²¡æœ‰è´¦å·ï¼Œç«‹å³æ³¨å†Œ->")]),v(e(te),{block:"",color:"#8a2be2",size:"large",loading:i.value,style:{"margin-top":"20px",background:"linear-gradient(327deg, rgb(97 115 255) 10.79%, rgb(239 27 225) 87.08%)",opacity:"1"},onClick:W},{default:C(()=>[$(" ç™»å½• ")]),_:1},8,["loading"])],64)):N("",!0)])])]),_:1},8,["show"]))}});const Rt={class:"flex flex-col w-full h-full"},Bt={class:"flex-1 overflow-hidden"},$t={key:0,class:"flex items-center justify-center mt-4 text-center text-neutral-300"},It=a("span",null,"Aha~",-1),At={key:1},Ut={class:"sticky bottom-0 left-0 flex justify-center"},Ot={class:"w-full max-w-screen-xl m-auto"},Lt={class:"flex items-center justify-between space-x-2"},Dt={class:"text-xl text-[#4f555e] dark:text-white"},zt={class:"text-xl text-[#4f555e] dark:text-white"},Pt={class:"text-white"},Et=oe({__name:"index",setup(o){let l=new AbortController;const r=!1,f=Le(),h=Ye(),s=le(),i=se(),b=ue(),k=U(()=>b.userInfo),{isMobile:x}=he(),{addChat:z,updateChat:I,updateChatSome:B,getChatByUuidAndIndex:L,getChatData:K}=ut(),{scrollRef:J,scrollToBottom:R,scrollToBottomIfAtBottom:H}=ct(),{usingContext:Q,toggleUsingContext:P}=dt(),{uuid:p}=f.params,T=U(()=>i.getChatByUuid(+p)),W=U(()=>T.value.filter(t=>!t.inversion&&!!t.conversationOptions)),A=y(""),n=y(!1),c=y(null),w=xe(),ne=y(!1);ye(()=>w.showModal,(t,u)=>{t&&!u&&(ne.value=!0,w.updateSetting({showModal:!1,modalType:"login"}))},{immediate:!0});const _e=qe(),{promptList:pe}=De(_e);T.value.forEach((t,u)=>{t.loading&&B(+p,u,{loading:!1})});function re(){Ie.value||Oe()&&we()}async function we(){var S;let t=A.value;if(n.value||!t||t.trim()==="")return;l=new AbortController,z(+p,{dateTime:new Date().toLocaleString(),text:t,inversion:!0,error:!1,conversationOptions:null,requestOptions:{prompt:t,options:null}}),R(),n.value=!0,A.value="";let u={};const _=(S=W.value[W.value.length-1])==null?void 0:S.conversationOptions;_&&Q.value&&(u={..._}),z(+p,{dateTime:new Date().toLocaleString(),text:"",loading:!0,inversion:!1,error:!1,conversationOptions:null,requestOptions:{prompt:t,options:{...u}}}),R();try{let d="";await(async()=>{let E;await ve({prompt:t,options:u,signal:l.signal,onDownloadProgress:({event:ie})=>{const G=ie.target,{responseText:Z}=G,X=Z.lastIndexOf(`
`,Z.length-2);let q=Z;X!==-1&&(q=Z.substring(X));try{const Y=JSON.parse(q);I(+p,T.value.length-1,{dateTime:new Date().toLocaleString(),text:d+(Y.text??""),inversion:!1,error:!1,loading:!0,conversationOptions:{conversationId:Y.conversationId,parentMessageId:Y.id},requestOptions:{prompt:t,options:{...u}}}),B(+p,T.value.length-1,{showTooLong:!1}),clearTimeout(E),E=setTimeout(()=>{B(+p,T.value.length-1,{showTooLong:!0}),console.log("long")},2500),r&&Y.detail.choices[0].finish_reason,H()}catch{}}}),B(+p,T.value.length-1,{loading:!1})})()}catch(d){const j=(d==null?void 0:d.message)??g("common.wrong");if(d.message==="canceled"){B(+p,T.value.length-1,{loading:!1}),H();return}const E=L(+p,T.value.length-1);if(E!=null&&E.text&&E.text!==""){B(+p,T.value.length-1,{text:`${E.text}
[${j}]`,error:!1,loading:!1});return}I(+p,T.value.length-1,{dateTime:new Date().toLocaleString(),text:j,inversion:!1,error:!0,loading:!1,conversationOptions:null,requestOptions:{prompt:t,options:{...u}}}),H()}finally{n.value=!1}}async function Ce(t){if(n.value)return;l=new AbortController;const{requestOptions:u}=T.value[t];let _=(u==null?void 0:u.prompt)??"",S={};u.options&&(S={...u.options}),n.value=!0,I(+p,t,{dateTime:new Date().toLocaleString(),text:"",inversion:!1,error:!1,loading:!0,conversationOptions:null,requestOptions:{prompt:_,options:{...S}}});try{let d="";await(async()=>{await ve({prompt:_,options:S,signal:l.signal,onDownloadProgress:({event:E})=>{const ie=E.target,{responseText:G}=ie,Z=G.lastIndexOf(`
`,G.length-2);let X=G;Z!==-1&&(X=G.substring(Z));try{const q=JSON.parse(X);I(+p,t,{dateTime:new Date().toLocaleString(),text:d+(q.text??""),inversion:!1,error:!1,loading:!0,conversationOptions:{conversationId:q.conversationId,parentMessageId:q.id},requestOptions:{prompt:_,options:{...S}}}),r&&q.detail.choices[0].finish_reason}catch{}}}),B(+p,t,{loading:!1})})()}catch(d){if(d.message==="canceled"){B(+p,t,{loading:!1});return}const j=(d==null?void 0:d.message)??g("common.wrong");I(+p,t,{dateTime:new Date().toLocaleString(),text:j,inversion:!1,error:!0,loading:!1,conversationOptions:null,requestOptions:{prompt:_,options:{...S}}})}finally{n.value=!1}}function fe(){if(n.value)return;const t=h.warning({title:g("chat.exportImage"),content:g("chat.exportImageConfirm"),positiveText:g("common.yes"),negativeText:g("common.no"),onPositiveClick:async()=>{try{t.loading=!0;const u=document.getElementById("image-wrapper"),S=(await ze(u,{useCORS:!0})).toDataURL("image/png"),d=document.createElement("a");d.style.display="none",d.href=S,d.setAttribute("download","chat-shot.png"),typeof d.download>"u"&&d.setAttribute("target","_blank"),document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(S),t.loading=!1,s.success(g("chat.exportSuccess")),Promise.resolve()}catch{s.error(g("chat.exportFailed"))}finally{t.loading=!1}}})}function be(t){n.value||h.warning({title:g("chat.deleteMessage"),content:g("chat.deleteMessageConfirm"),positiveText:g("common.yes"),negativeText:g("common.no"),onPositiveClick:()=>{i.deleteChatByUuid(+p,t)}})}function ke(){n.value||h.warning({title:g("chat.clearChat"),content:g("chat.clearChatConfirm"),positiveText:g("common.yes"),negativeText:g("common.no"),onPositiveClick:()=>{i.clearChatByUuid(+p)}})}function Te(t){x.value?t.key==="Enter"&&t.ctrlKey&&(t.preventDefault(),re()):t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),re())}function Se(){n.value&&(l.abort(),n.value=!1)}const Re=U(()=>A.value.startsWith("/")?pe.value.filter(t=>t.key.toLowerCase().includes(A.value.substring(1).toLowerCase())).map(t=>({label:t.value,value:t.value})):[]),Be=t=>{for(const u of pe.value)if(u.value===t.label)return[u.key];return[]},$e=U(()=>x.value?g("chat.placeholderMobile"):g("chat.placeholder")),Ie=U(()=>n.value||!A.value||A.value.trim()===""),Ae=U(()=>{let t=["p-4"];return x.value&&(t=["sticky","left-0","bottom-0","right-0","p-2","pr-3","overflow-hidden"]),t});Ze(()=>{var t;R(),c.value&&!x.value&&((t=c.value)==null||t.focus()),setTimeout(()=>{K()[0].data.length==0&&z(+p,{dateTime:new Date().toLocaleString(),text:"å¾ˆé«˜å…´å†æ¬¡è§åˆ°ä½ ï¼Œæˆ‘æ˜¯çŸ¥æ½®GPTï¼Œæœ‰ä»€ä¹ˆé—®é¢˜éœ€è¦è§£å†³å—ï¼Ÿ",inversion:!1,error:!1,conversationOptions:null,requestOptions:{prompt:"eeeeeeeee",options:null}})},100)}),Je(()=>{n.value&&l.abort()});function Ue(){ne.value=!1}function Oe(){return k.value.isLogin?!0:K()[0].data.length>=4?(console.log("login"),ne.value=!0,!1):!0}return(t,u)=>(m(),D("div",Rt,[e(x)?(m(),O(vt,{key:0,"using-context":e(Q),onExport:fe,onToggleUsingContext:e(P)},null,8,["using-context","onToggleUsingContext"])):N("",!0),a("main",Bt,[a("div",{id:"scrollRef",ref_key:"scrollRef",ref:J,class:"h-full overflow-hidden overflow-y-auto"},[a("div",{id:"image-wrapper",class:F(["w-full max-w-screen-xl m-auto",[e(x)?"p-2 pt-12":"p-4"]])},[e(T).length?(m(),D("div",At,[(m(!0),D(ee,null,We(e(T),(_,S)=>(m(),O(e(it),{key:S,"date-time":_.dateTime,text:_.text,inversion:_.inversion,error:_.error,loading:_.loading,"show-too-long":_.showTooLong,onRegenerate:d=>Ce(S),onDelete:d=>be(S)},null,8,["date-time","text","inversion","error","loading","show-too-long","onRegenerate","onDelete"]))),128)),a("div",Ut,[n.value?(m(),O(e(te),{key:0,type:"warning",onClick:Se},{icon:C(()=>[v(e(M),{icon:"ri:stop-circle-line"})]),default:C(()=>[$(" Stop Responding ")]),_:1})):N("",!0)])])):(m(),D("div",$t,[v(e(M),{icon:"ri:bubble-chart-fill",class:"mr-2 text-3xl"}),It]))],2)],512)]),a("footer",{class:F(e(Ae))},[a("div",Ot,[a("div",Lt,[v(e(me),{title:"æ¸…ç©ºå½“å‰ä¼šè¯",onClick:ke},{default:C(()=>[a("span",Dt,[v(e(M),{icon:"carbon:clean"})])]),_:1}),e(x)?N("",!0):(m(),O(e(me),{key:0,title:"ä¿å­˜ä¼šè¯ä¸ºå›¾ç‰‡",onClick:fe},{default:C(()=>[a("span",zt,[v(e(M),{icon:"ri:download-2-line"})])]),_:1})),v(e(et),{value:A.value,"onUpdate:value":u[1]||(u[1]=_=>A.value=_),options:e(Re),"render-label":Be},{default:C(({handleInput:_,handleBlur:S,handleFocus:d})=>[v(e(V),{ref_key:"inputRef",ref:c,value:A.value,"onUpdate:value":u[0]||(u[0]=j=>A.value=j),style:{padding:"5px"},type:"textarea",placeholder:e($e),autosize:{minRows:1,maxRows:e(x)?4:8},onInput:_,onFocus:d,onBlur:S,onKeypress:Te},null,8,["value","placeholder","autosize","onInput","onFocus","onBlur"])]),_:1},8,["value","options"]),v(e(te),{id:"sendButton",type:"primary",style:{padding:"21px 12px","border-radius":"21px"},onClick:re},{icon:C(()=>[a("span",Pt,[v(e(M),{icon:"ri:send-plane-fill"})])]),_:1}),v(St,{visible:ne.value,onCanClose:Ue},null,8,["visible"])])])],2)]))}});const Ft=Object.freeze(Object.defineProperty({__proto__:null,default:Et},Symbol.toStringTag,{value:"Module"}));export{at as c,Ft as i};
