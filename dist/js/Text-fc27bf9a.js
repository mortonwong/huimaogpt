import{M as S}from"./markdown-it-e3a1182a.js";import{m as L}from"./markdown-it-link-attributes-37292d98.js";import{H as y}from"./highlight.js-f1ebc9d8.js";import{k as M}from"./katex-eae73049.js";import{a as T,t as E}from"./index-aba851d6.js";import{c as R}from"./index-accf80f5.js";import{d as q,r as A,c as $,b as H,a6 as I,A as O,R as d,S as f,X as B,P as h,V as v,F as V,_ as C,Z as z}from"./@vue-592ec505.js";import"./date-fns-9733c85e.js";import"./uc.micro-740ead6f.js";import"./mdurl-79eba04e.js";import"./linkify-it-191b779c.js";import"./punycode-3f09cc15.js";import"./naive-ui-55c6bd72.js";import"./vooks-9f50f2ef.js";import"./evtd-b614532e.js";import"./vdirs-b0483831.js";import"./treemate-25c27bff.js";import"./seemly-411025cc.js";import"./vueuc-72877a4a.js";import"./@css-render-80c01661.js";import"./@juggle-41516555.js";import"./css-render-d3958e6a.js";import"./@emotion-8a8e73f6.js";import"./lodash-es-cabc0acd.js";import"./pinia-af09d699.js";import"./vue-router-c5800335.js";import"./axios-760d4776.js";import"./@vueuse-2be4af1e.js";import"./vue-i18n-2e8fc103.js";import"./@intlify-7347860c.js";import"./@iconify-4e28c541.js";import"./html2canvas-18c4afc9.js";function w(e,r){const o=e.posMax;let s=!0,n=!0;const i=r>0?e.src.charCodeAt(r-1):-1,t=r+1<=o?e.src.charCodeAt(r+1):-1;return(i===32||i===9||t>=48&&t<=57)&&(n=!1),(t===32||t===9)&&(s=!1),{can_open:s,can_close:n}}function D(e,r){let o,s,n,i;if(e.src[e.pos]!=="$")return!1;if(n=w(e,e.pos),!n.can_open)return r||(e.pending+="$"),e.pos+=1,!0;const t=e.pos+1;for(o=t;(o=e.src.indexOf("$",o))!==-1;){for(i=o-1;e.src[i]==="\\";)i-=1;if((o-i)%2==1)break;o+=1}return o===-1?(r||(e.pending+="$"),e.pos=t,!0):o-t===0?(r||(e.pending+="$$"),e.pos=t+1,!0):(n=w(e,o),n.can_close?(r||(s=e.push("math_inline","math",0),s.markup="$",s.content=e.src.slice(t,o)),e.pos=o+1,!0):(r||(e.pending+="$"),e.pos=t,!0))}function F(e,r,o,s){let n,i,t,c,m=!1,u,p=e.bMarks[r]+e.tShift[r],l=e.eMarks[r];if(p+2>l||e.src.slice(p,p+2)!=="$$")return!1;if(p+=2,n=e.src.slice(p,l),s)return!0;for(n.trim().slice(-2)==="$$"&&(n=n.trim().slice(0,-2),m=!0),t=r;!m&&(t++,!(t>=o||(p=e.bMarks[t]+e.tShift[t],l=e.eMarks[t],p<l&&e.tShift[t]<e.blkIndent)));)e.src.slice(p,l).trim().slice(-2)==="$$"&&(c=e.src.slice(0,l).lastIndexOf("$$"),i=e.src.slice(p,c),m=!0);return e.line=t+1,u=e.push("math_block","math",0),u.block=!0,u.content=(n&&n.trim()?`${n}
`:"")+e.getLines(r+1,t,e.tShift[r],!0)+(i&&i.trim()?i:""),u.map=[r,e.line],u.markup="$$",!0}function x(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}let b;function N(e,r){r=r||{},r.katex&&(b=r.katex),r.blockClass||(r.blockClass="");const o=function(t){r.displayMode=!1;try{return b.renderToString(t,r)}catch(c){return r.throwOnError&&console.log(c),`<span class='katex-error' title='${x(c.toString())}'>${x(t)}</span>`}},s=function(t,c){return o(t[c].content)},n=function(t){r.displayMode=!0;try{return`<p class="katex-block ${r.blockClass}">${b.renderToString(t,r)}</p>`}catch(c){return r.throwOnError&&console.log(c),`<p class='katex-block katex-error ${r.blockClass}' title='${x(c.toString())}'>${x(t)}</p>`}},i=function(t,c){return`${n(t[c].content)}
`};e.inline.ruler.after("escape","math_inline",D),e.block.ruler.after("blockquote","math_block",F,{alt:["paragraph","reference","blockquote","list"]}),e.renderer.rules.math_inline=s,e.renderer.rules.math_block=i}const P={key:0},U=["innerHTML"],j=["textContent"],J=["textContent"],K=B("span",{class:"dark:text-white w-[4px] h-[20px] block animate-blink",style:{color:"#f0a020",display:"inline-block"}},null,-1),X={key:0,style:{color:"rgb(180 180 180)","font-size":"0.9rem",position:"relative",top:"-5px",left:"5px"}},Se=q({__name:"Text",props:{inversion:{type:Boolean},error:{type:Boolean},text:null,loading:{type:Boolean},asRawText:{type:Boolean},showTooLong:{type:Boolean}},emits:["load"],setup(e,{emit:r}){const o=e,{isMobile:s}=T(),n=A(),i=new S({html:!1,linkify:!0,highlight(l,a){if(!!(a&&y.getLanguage(a))){const k=a??"";return m(y.highlight(l,{language:k}).value,k)}return m(y.highlightAuto(l).value,"")}});i.use(L,{attrs:{target:"_blank",rel:"noopener"}}),i.use(N,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"%%",right:"%%",display:!1}],blockClass:"katexmath-block rounded-md p-[10px]",errorColor:" #cc0000",katex:M});const t=$(()=>["text-wrap","min-w-[20px]","rounded-md",s.value?"p-2":"px-3 py-2",o.inversion?"bg-[#d2f9d1]":"bg-[#f4f6f8]",o.inversion?"dark:bg-[#a1dc95]":"dark:bg-[#25282e]",o.inversion?"message-request":"message-reply",{"text-red-500":o.error}]),c=$(()=>{const l=o.text??"";return o.asRawText?l:i.render(l)});function m(l,a){return`<pre class="code-block-wrapper"><div class="code-block-header"><span class="code-block-header__lang">${a}</span><span class="code-block-header__copy">${E("chat.copyCode")}</span></div><code class="hljs code-block-body ${a}">${l}</code></pre>`}function u(){n.value&&n.value.querySelectorAll(".code-block-header__copy").forEach(a=>{a.addEventListener("click",()=>{var k,_;const g=(_=(k=a.parentElement)==null?void 0:k.nextElementSibling)==null?void 0:_.textContent;g&&R(g).then(()=>{a.textContent="复制成功",setTimeout(()=>{a.textContent="复制代码"},1e3)})})})}function p(){n.value&&n.value.querySelectorAll(".code-block-header__copy").forEach(a=>{a.removeEventListener("click",()=>{})})}return H(()=>{r("load"),u()}),I(()=>{u()}),O(()=>{p()}),(l,a)=>(d(),f("div",{class:z(["text-black",h(t)])},[B("div",{ref_key:"textRef",ref:n,class:"leading-relaxed break-words"},[e.inversion?(d(),f("div",{key:1,class:"whitespace-pre-wrap",textContent:v(h(c))},null,8,J)):(d(),f("div",P,[e.asRawText?(d(),f("div",{key:1,class:"whitespace-pre-wrap",textContent:v(h(c))},null,8,j)):(d(),f("div",{key:0,class:"markdown-body",innerHTML:h(c)},null,8,U))])),e.loading?(d(),f(V,{key:2},[K,e.showTooLong?(d(),f("span",X,"内容可能有点长，思考中……")):C("",!0)],64)):C("",!0)],512)],2))}});export{Se as default};
