import{b as Oe}from"./vue-router-c5800335.js";import{s as De}from"./pinia-af09d699.js";import{h as ze}from"./html2canvas-18c4afc9.js";import{u as ue,i as Pe,d as ge,_ as O,a as me,t as g,b as Ee,c as le,e as Me,f as se,g as xe,s as Ne,h as Ze,j as Ke,k as Ve,l as ve}from"./index-aba851d6.js";import{d as te,c as I,R as m,S as D,P as e,W as P,F as Q,X as a,h as je,$ as qe,r as w,N as l,Z,V as de,a1 as Fe,_ as q,U as C,n as ae,j as ye,e as L,b as He,A as Je,Y as We}from"./@vue-592ec505.js";import{q as he,f as re,H as Ge,I as Xe,h as j,l as ee,n as Ye,e as Qe,J as et}from"./naive-ui-55c6bd72.js";const tt={key:1,class:"text-[28px] dark:text-white text-[#839bf1]"},ot=a("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32","aria-hidden":"true",width:"1em",height:"1em"},[a("path",{d:"M29.71,13.09A8.09,8.09,0,0,0,20.34,2.68a8.08,8.08,0,0,0-13.7,2.9A8.08,8.08,0,0,0,2.3,18.9,8,8,0,0,0,3,25.45a8.08,8.08,0,0,0,8.69,3.87,8,8,0,0,0,6,2.68,8.09,8.09,0,0,0,7.7-5.61,8,8,0,0,0,5.33-3.86A8.09,8.09,0,0,0,29.71,13.09Zm-12,16.82a6,6,0,0,1-3.84-1.39l.19-.11,6.37-3.68a1,1,0,0,0,.53-.91v-9l2.69,1.56a.08.08,0,0,1,.05.07v7.44A6,6,0,0,1,17.68,29.91ZM4.8,24.41a6,6,0,0,1-.71-4l.19.11,6.37,3.68a1,1,0,0,0,1,0l7.79-4.49V22.8a.09.09,0,0,1,0,.08L13,26.6A6,6,0,0,1,4.8,24.41ZM3.12,10.53A6,6,0,0,1,6.28,7.9v7.57a1,1,0,0,0,.51.9l7.75,4.47L11.85,22.4a.14.14,0,0,1-.09,0L5.32,18.68a6,6,0,0,1-2.2-8.18Zm22.13,5.14-7.78-4.52L20.16,9.6a.08.08,0,0,1,.09,0l6.44,3.72a6,6,0,0,1-.9,10.81V16.56A1.06,1.06,0,0,0,25.25,15.67Zm2.68-4-.19-.12-6.36-3.7a1,1,0,0,0-1.05,0l-7.78,4.49V9.2a.09.09,0,0,1,0-.09L19,5.4a6,6,0,0,1,8.91,6.21ZM11.08,17.15,8.38,15.6a.14.14,0,0,1-.05-.08V8.1a6,6,0,0,1,9.84-4.61L18,3.6,11.61,7.28a1,1,0,0,0-.53.91ZM12.54,14,16,12l3.47,2v4L16,20l-3.47-2Z",fill:"currentColor"})],-1),nt=[ot],at=te({__name:"Avatar",props:{image:{type:Boolean}},setup(t){const r=ue(),i=I(()=>r.userInfo.avatar);return(v,h)=>t.image?(m(),D(Q,{key:0},[e(Pe)(e(i))&&e(i).length>0?(m(),P(e(he),{key:0,src:e(i),"fallback-src":e(ge)},null,8,["src","fallback-src"])):(m(),P(e(he),{key:1,round:"",src:e(ge)},null,8,["src"]))],64)):(m(),D("span",tt,nt))}}),st=()=>({iconRender:r=>{const{color:i,fontSize:v,icon:h}=r,s={};return i&&(s.color=i),v&&(s.fontSize=`${v}px`),h||window.console.warn("iconRender: icon is required"),()=>je(O,{icon:h,style:s})}});function lt(t){return new Promise((r,i)=>{try{const v=document.createElement("textarea");v.setAttribute("readonly","readonly"),v.value=t,document.body.appendChild(v),v.select(),document.execCommand("copy")&&document.execCommand("copy"),document.body.removeChild(v),r(t)}catch(v){i(v)}})}const rt={class:"flex flex-col"},it={class:"transition text-neutral-300 hover:text-neutral-800 dark:hover:text-neutral-200"},ct=te({__name:"index",props:{dateTime:null,text:null,inversion:{type:Boolean},error:{type:Boolean},loading:{type:Boolean},showTooLong:{type:Boolean}},emits:["regenerate","delete"],setup(t,{emit:r}){const i=t,v=qe(()=>Ee(()=>import("./Text-fc27bf9a.js"),["js/Text-fc27bf9a.js","js/markdown-it-e3a1182a.js","js/date-fns-9733c85e.js","js/uc.micro-740ead6f.js","js/mdurl-79eba04e.js","js/linkify-it-191b779c.js","js/punycode-3f09cc15.js","js/markdown-it-link-attributes-37292d98.js","js/highlight.js-f1ebc9d8.js","js/katex-eae73049.js","css/katex-df47a520.css","js/index-aba851d6.js","js/@vue-592ec505.js","js/naive-ui-55c6bd72.js","js/vooks-9f50f2ef.js","js/evtd-b614532e.js","js/vdirs-b0483831.js","js/treemate-25c27bff.js","js/seemly-411025cc.js","js/vueuc-72877a4a.js","js/@css-render-80c01661.js","js/@juggle-41516555.js","js/css-render-d3958e6a.js","js/@emotion-8a8e73f6.js","js/lodash-es-cabc0acd.js","js/pinia-af09d699.js","js/vue-router-c5800335.js","js/axios-760d4776.js","js/@vueuse-2be4af1e.js","js/vue-i18n-2e8fc103.js","js/@intlify-7347860c.js","js/@iconify-4e28c541.js","css/index-4e66412a.css","js/html2canvas-18c4afc9.js","css/Text-f0f3af04.css"])),{isMobile:h}=me(),{iconRender:s}=st(),c=re(),$=w(),x=w(i.inversion),y=w(),R=I(()=>{const A=[{label:g("chat.copy"),key:"copyText",icon:s({icon:"ri:file-copy-2-line"})},{label:g("common.delete"),key:"delete",icon:s({icon:"ri:delete-bin-line"})}];return i.inversion||A.unshift({label:x.value?g("chat.preview"):g("chat.showRawText"),key:"toggleRenderType",icon:s({icon:x.value?"ic:outline-code-off":"ic:outline-code"})}),A});function B(A){switch(A){case"copyText":z();return;case"toggleRenderType":x.value=!x.value;return;case"delete":r("delete")}}function k(){var A;(A=y.value)==null||A.scrollIntoView(),r("regenerate")}async function z(){try{await lt(i.text||""),c.success("复制成功")}catch{c.error("复制失败")}}const N=w(!0);function J(){N.value=!1}return(A,F)=>(m(),D("div",{ref_key:"messageRef",ref:y,class:Z(["flex w-full mb-6 overflow-hidden",[{"flex-row-reverse":t.inversion}]])},[a("div",{class:Z(["flex items-center justify-center flex-shrink-0 h-8 overflow-hidden rounded-full basis-8",[t.inversion?"ml-2":"mr-2"]])},[l(at,{image:t.inversion},null,8,["image"])],2),a("div",{class:Z(["overflow-hidden text-base",[t.inversion?"items-end":"items-start"]])},[a("p",{class:Z(["text-xs text-[#b4bbc4]",[t.inversion?"text-right":"text-left"]])},de(t.dateTime),3),a("div",{class:Z(["flex items-end gap-1 mt-2",[t.inversion?"flex-row-reverse":"flex-row"]])},[(m(),P(Fe(e(v)),{ref_key:"textRef",ref:$,inversion:t.inversion,error:t.error,text:t.text,loading:t.loading,"show-too-long":t.showTooLong,"as-raw-text":x.value,class:Z([t.inversion?"mySay":"gptSay"]),onLoad:J},null,40,["inversion","error","text","loading","show-too-long","as-raw-text","class"])),N.value?(m(),P(e(Ge),{key:0,height:"40px",round:""})):q("",!0),a("div",rt,[t.inversion?q("",!0):(m(),D("button",{key:0,class:"mb-2 transition text-neutral-300 hover:text-neutral-800 dark:hover:text-neutral-300",onClick:k},[l(e(O),{icon:"ri:restart-line"})])),l(e(Xe),{trigger:e(h)?"click":"hover",placement:t.inversion?"left":"right",options:e(R),onSelect:B},{default:C(()=>[a("button",it,[l(e(O),{icon:"ri:more-2-fill"})])]),_:1},8,["trigger","placement","options"])])],2)],2)],2))}});function ut(){const t=w(null);return{scrollRef:t,scrollToBottom:async()=>{await ae(),t.value&&(t.value.scrollTop=t.value.scrollHeight)},scrollToTop:async()=>{await ae(),t.value&&(t.value.scrollTop=0)},scrollToBottomIfAtBottom:async()=>{await ae(),t.value&&t.value.scrollHeight-t.value.scrollTop-t.value.clientHeight<=100&&(t.value.scrollTop=t.value.scrollHeight)}}}function dt(){const t=le();return{addChat:(c,$)=>{t.addChatByUuid(c,$)},updateChat:(c,$,x)=>{t.updateChatByUuid(c,$,x)},updateChatSome:(c,$,x)=>{t.updateChatSomeByUuid(c,$,x)},getChatByUuidAndIndex:(c,$)=>t.getChatByUuidAndIndex(c,$),getChatData:()=>t.getChatData()}}function ft(){const t=re(),r=le(),i=I(()=>r.usingContext);function v(){r.setUsingContext(!i.value),i.value?t.success(g("chat.turnOnContext")):t.warning(g("chat.turnOffContext"))}return{usingContext:i,toggleUsingContext:v}}const pt={class:"sticky top-0 left-0 right-0 z-30 border-b dark:border-neutral-800 bg-white/80 dark:bg-black/20 backdrop-blur"},gt={class:"relative flex items-center justify-between min-w-0 overflow-hidden h-14"},vt={class:"flex items-center"},ht={class:"flex items-center space-x-2"},mt={class:"text-xl text-[#4f555e] dark:text-white"},xt=te({__name:"index",props:{usingContext:{type:Boolean}},emits:["export","toggleUsingContext"],setup(t,{emit:r}){const i=Me(),v=le(),h=I(()=>i.siderCollapsed),s=I(()=>v.getChatHistoryByCurrentActive);function c(){i.setSiderCollapsed(!h.value)}function $(){const R=document.querySelector("#scrollRef");R&&ae(()=>R.scrollTop=0)}function x(){r("export")}function y(){r("toggleUsingContext")}return(R,B)=>{var k;return m(),D("header",pt,[a("div",gt,[a("div",vt,[a("button",{class:"flex items-center justify-center w-11 h-11",onClick:c},[e(h)?(m(),P(e(O),{key:0,class:"text-2xl",icon:"ri:align-justify"})):(m(),P(e(O),{key:1,class:"text-2xl",icon:"ri:align-right"}))])]),a("h1",{class:"flex-1 px-4 pr-6 overflow-hidden cursor-pointer select-none text-ellipsis whitespace-nowrap",onDblclick:$},de(((k=e(s))==null?void 0:k.title)??""),33),a("div",ht,[l(e(se),{onClick:y},{default:C(()=>[a("span",{class:Z(["text-xl",{"text-[#154EC1]":t.usingContext,"text-[#a8071a]":!t.usingContext}])},[l(e(O),{icon:"ri:chat-history-line"})],2)]),_:1}),l(e(se),{onClick:x},{default:C(()=>[a("span",mt,[l(e(O),{icon:"ri:download-2-line"})])]),_:1})])])])}}}),yt={class:"p-10 bg-white rounded dark:bg-slate-800"},wt={class:"space-y-4"},Ct={class:"space-y-2",style:{position:"relative"}},_t=a("div",{style:{background:"linear-gradient(139deg, rgb(254 50 50) 10.79%, rgb(27 153 239) 87.08%)",color:"rgb(255, 255, 255)",position:"absolute",right:"68px","font-size":"0.9rem",top:"3px",width:"49px",height:"25px","text-align":"center","line-height":"25px","border-radius":"11px"}}," 免费 ",-1),bt={class:"text-2xl font-bold text-center text-slate-800 dark:text-neutral-200",style:{"font-size":"1.8rem"}},kt=a("p",{class:"text-base text-center text-slate-500 dark:text-slate-500",style:{"font-size":"0.9rem","letter-spacing":"0.8px","font-weight":"600","margin-top":"4px"}},[L(" 🤖以继续免费和我对话"),a("br")],-1),Tt={style:{"text-align":"right","font-size":"0.8rem"}},St=a("p",{class:"text-base text-center text-slate-500 dark:text-slate-500",style:{"font-size":"0.9rem","letter-spacing":"0.8px","font-weight":"600","margin-top":"4px"}},[L(" 🎉仅剩一步！即将和我继续对话~"),a("br")],-1),$t=a("p",{class:"text-base text-center text-slate-500 dark:text-slate-500",style:{"font-size":"0.9rem","letter-spacing":"0.8px","font-weight":"600","margin-top":"4px"}},[L(" 🎉仅剩一步！即将和我对话~"),a("br")],-1),At={style:{"text-align":"right","font-size":"0.8rem"}},Rt=te({__name:"Permission",props:{visible:{type:Boolean}},emits:["canClose"],setup(t,{emit:r}){const i=ue(),v=xe(),h=w("register_step1");ye(()=>v.modalType,(n,u)=>{n&&(h.value=n)},{immediate:!0});const s=re(),c=w(!1);function $(n){n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),J())}function x(n){n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),F())}const y=w(""),R=w(""),B=w(""),k=w(""),z=w(""),N=w("");async function J(){if(!y.value){s.error("请输入email");return}if(!A(y.value)){s.error("email格式不正确，请重新输入");return}try{c.value=!0;const n=await Ne(y.value);s.success("已向邮箱发送验证码，请注意查收~"),N.value=n.SCC,console.log(N.value),h.value="register_step2"}catch(n){s.error(n.message??"error")}finally{c.value=!1}}function A(n){const u=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return console.log(u.test(n)),u.test(n)}async function F(){if(!/^\d{6}$/.test(R.value)){s.error("邮箱验证码格式错误，应为六位数字");return}if(B.value!==k.value){s.error("两次输入的密码不一样");return}if(!/^[A-Za-z0-9!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]{6,15}$/.test(B.value)){s.error("密码格式错误，应该为6~15位数字、字母、常用符号的任意组合");return}if(!/^[a-zA-Z0-9_\-.u4e00-\u9FA5]+$/.test(z.value)&&(z.value.length<2||z.value.length>20)){s.error("用户名格式错误，应该为2~20个字符之间的数字、字母、常用符号的任意组合");return}try{c.value=!0,await Ze(y.value,R.value,z.value,B.value,N.value),s.success("注册成功！自动为您登陆……"),r("canClose",!0),i.updateUserInfo({name:z.value,isLogin:!0,vip:0})}catch(n){s.error(n.message??"error")}finally{c.value=!1}}function G(n){h.value=n}const E=w(""),p=w(""),T=w("");async function oe(){if(!E.value){s.error("请输入用户名或Email");return}if(A(E.value))T.value="email";else if(/^[a-zA-Z0-9_\-.u4e00-\u9FA5]+$/.test(E.value)||E.value.length<2||E.value.length>20)T.value="username";else{s.error("账号格式错误，请输入用户名或Email");return}if(!/^[A-Za-z0-9!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]{6,15}$/.test(p.value)){s.error("密码格式错误，应该为6~15位数字、字母、常用符号的任意组合");return}try{c.value=!0;const n=await Ke(E.value,p.value,T.value);s.success(`登录成功！欢迎${n.userName}`),r("canClose",!0),i.updateUserInfo({name:n.userName,isLogin:!0,vip:0})}catch(n){s.error(n.message??"error")}finally{c.value=!1}}function U(){r("canClose",!0)}return(n,u)=>(m(),P(e(Ye),{show:t.visible,"auto-focus":!1,style:{width:"90%","max-width":"380px"},onMaskClick:U},{default:C(()=>[a("div",yt,[a("div",wt,[a("header",Ct,[_t,a("h2",bt,de(h.value==="register_step1"||h.value==="register_step2"?"注册":"登录"),1)]),h.value==="register_step1"?(m(),D(Q,{key:0},[kt,l(e(j),{value:y.value,"onUpdate:value":u[0]||(u[0]=b=>y.value=b),type:"text",size:"large",autofocus:!1,placeholder:"请输入电子邮箱,如xxx@xxx.xxx",onKeypress:$},{prefix:C(()=>[L(" Email ")]),_:1},8,["value"]),a("div",Tt,[a("a",{style:{cursor:"pointer"},onClick:u[1]||(u[1]=b=>G("login"))},"已有账号，立即登录->")]),l(e(ee),{block:"",color:"#8a2be2",size:"large",loading:c.value,style:{"margin-top":"15px",background:"linear-gradient(327deg, rgb(97 115 255) 10.79%, rgb(239 27 225) 87.08%)",opacity:"1"},onClick:J},{default:C(()=>[L(" 使用电子邮箱注册 ")]),_:1},8,["loading"])],64)):q("",!0),h.value=="register_step2"?(m(),D(Q,{key:1},[St,l(e(j),{value:R.value,"onUpdate:value":u[2]||(u[2]=b=>R.value=b),size:"large",placeholder:"Email收到的6位数字验证码",onKeypress:x},{prefix:C(()=>[L(" 验证码 ")]),_:1},8,["value"]),l(e(j),{value:z.value,"onUpdate:value":u[3]||(u[3]=b=>z.value=b),size:"large",placeholder:"请设置用户名,可中文可英文",onKeypress:x},{prefix:C(()=>[L(" 用户名 ")]),_:1},8,["value"]),l(e(j),{value:B.value,"onUpdate:value":u[4]||(u[4]=b=>B.value=b),size:"large",type:"password",placeholder:"请设置密码",onKeypress:x},{prefix:C(()=>[L(" 密码 ")]),_:1},8,["value"]),l(e(j),{value:k.value,"onUpdate:value":u[5]||(u[5]=b=>k.value=b),size:"large",type:"password",placeholder:"请再次输入密码",onKeypress:x},{prefix:C(()=>[L(" 密码 ")]),_:1},8,["value"]),l(e(ee),{block:"",color:"#8a2be2",size:"large",loading:c.value,style:{"margin-top":"20px",background:"linear-gradient(327deg, rgb(97 115 255) 10.79%, rgb(239 27 225) 87.08%)",opacity:"1"},onClick:F},{default:C(()=>[L(" 注册并登录 ")]),_:1},8,["loading"])],64)):q("",!0),h.value==="login"?(m(),D(Q,{key:2},[$t,l(e(j),{value:E.value,"onUpdate:value":u[6]||(u[6]=b=>E.value=b),size:"large",placeholder:"请输入用户名或Email",onKeypress:x},{prefix:C(()=>[L(" 账号 ")]),_:1},8,["value"]),l(e(j),{value:p.value,"onUpdate:value":u[7]||(u[7]=b=>p.value=b),size:"large",type:"password",placeholder:"请输入密码",onKeypress:x},{prefix:C(()=>[L(" 密码 ")]),_:1},8,["value"]),a("div",At,[a("a",{style:{cursor:"pointer"},onClick:u[8]||(u[8]=b=>G("register_step1"))},"没有账号，立即注册->")]),l(e(ee),{block:"",color:"#8a2be2",size:"large",loading:c.value,style:{"margin-top":"20px",background:"linear-gradient(327deg, rgb(97 115 255) 10.79%, rgb(239 27 225) 87.08%)",opacity:"1"},onClick:oe},{default:C(()=>[L(" 登录 ")]),_:1},8,["loading"])],64)):q("",!0)])])]),_:1},8,["show"]))}});const Bt={class:"flex flex-col w-full h-full"},Lt={class:"flex-1 overflow-hidden"},Ut={key:0,class:"flex items-center justify-center mt-4 text-center text-neutral-300"},It=a("span",null,"Aha~",-1),Ot={key:1},Dt={class:"sticky bottom-0 left-0 flex justify-center"},zt={class:"w-full max-w-screen-xl m-auto"},Pt={class:"flex items-center justify-between space-x-2"},Et={class:"text-xl text-[#4f555e] dark:text-white"},Mt={class:"text-xl text-[#4f555e] dark:text-white"},Nt={class:"text-white"},Zt=te({__name:"index",setup(t){let r=new AbortController;const i=!1,v=Oe(),h=Qe(),s=re(),c=le(),$=ue(),x=I(()=>$.userInfo),{isMobile:y}=me(),{addChat:R,updateChat:B,updateChatSome:k,getChatByUuidAndIndex:z,getChatData:N}=dt(),{scrollRef:J,scrollToBottom:A,scrollToBottomIfAtBottom:F}=ut(),{usingContext:G,toggleUsingContext:E}=ft(),{uuid:p}=v.params,T=I(()=>c.getChatByUuid(+p)),oe=I(()=>T.value.filter(o=>!o.inversion&&!!o.conversationOptions)),U=w(""),n=w(!1),u=w(null),b=xe(),ne=w(!1);ye(()=>b.showModal,(o,d)=>{o&&!d&&(ne.value=!0,b.updateSetting({showModal:!1,modalType:"login"}))},{immediate:!0});const we=Ve(),{promptList:fe}=De(we);T.value.forEach((o,d)=>{o.loading&&k(+p,d,{loading:!1})});function ie(){Be.value||Ie()&&Ce()}async function Ce(){var S;let o=U.value;if(n.value||!o||o.trim()==="")return;r=new AbortController,R(+p,{dateTime:new Date().toLocaleString(),text:o,inversion:!0,error:!1,conversationOptions:null,requestOptions:{prompt:o,options:null}}),A(),n.value=!0,U.value="";let d={};const _=(S=oe.value[oe.value.length-1])==null?void 0:S.conversationOptions;_&&G.value&&(d={..._}),R(+p,{dateTime:new Date().toLocaleString(),text:"",loading:!0,inversion:!1,error:!1,conversationOptions:null,requestOptions:{prompt:o,options:{...d}}}),A();try{let f="";await(async()=>{let M;await ve({prompt:o,options:d,signal:r.signal,onDownloadProgress:({event:ce})=>{const W=ce.target,{responseText:H}=W,X=H.lastIndexOf(`
`,H.length-2);let V=H;X!==-1&&(V=H.substring(X));try{const Y=JSON.parse(V);B(+p,T.value.length-1,{dateTime:new Date().toLocaleString(),text:f+(Y.text??""),inversion:!1,error:!1,loading:!0,conversationOptions:{conversationId:Y.conversationId,parentMessageId:Y.id},requestOptions:{prompt:o,options:{...d}}}),k(+p,T.value.length-1,{showTooLong:!1}),clearTimeout(M),M=setTimeout(()=>{k(+p,T.value.length-1,{showTooLong:!0}),console.log("long")},2500),i&&Y.detail.choices[0].finish_reason,F()}catch{}}}),k(+p,T.value.length-1,{loading:!1})})()}catch(f){const K=(f==null?void 0:f.message)??g("common.wrong");if(f.message==="canceled"){k(+p,T.value.length-1,{loading:!1}),F();return}const M=z(+p,T.value.length-1);if(M!=null&&M.text&&M.text!==""){k(+p,T.value.length-1,{text:`${M.text}
[${K}]`,error:!1,loading:!1});return}B(+p,T.value.length-1,{dateTime:new Date().toLocaleString(),text:K,inversion:!1,error:!0,loading:!1,conversationOptions:null,requestOptions:{prompt:o,options:{...d}}}),F()}finally{n.value=!1}}async function _e(o){if(n.value)return;r=new AbortController;const{requestOptions:d}=T.value[o];let _=(d==null?void 0:d.prompt)??"",S={};d.options&&(S={...d.options}),n.value=!0,B(+p,o,{dateTime:new Date().toLocaleString(),text:"",inversion:!1,error:!1,loading:!0,conversationOptions:null,requestOptions:{prompt:_,options:{...S}}});try{let f="";await(async()=>{await ve({prompt:_,options:S,signal:r.signal,onDownloadProgress:({event:M})=>{const ce=M.target,{responseText:W}=ce,H=W.lastIndexOf(`
`,W.length-2);let X=W;H!==-1&&(X=W.substring(H));try{const V=JSON.parse(X);B(+p,o,{dateTime:new Date().toLocaleString(),text:f+(V.text??""),inversion:!1,error:!1,loading:!0,conversationOptions:{conversationId:V.conversationId,parentMessageId:V.id},requestOptions:{prompt:_,options:{...S}}}),i&&V.detail.choices[0].finish_reason}catch{}}}),k(+p,o,{loading:!1})})()}catch(f){if(f.message==="canceled"){k(+p,o,{loading:!1});return}const K=(f==null?void 0:f.message)??g("common.wrong");B(+p,o,{dateTime:new Date().toLocaleString(),text:K,inversion:!1,error:!0,loading:!1,conversationOptions:null,requestOptions:{prompt:_,options:{...S}}})}finally{n.value=!1}}function pe(){if(n.value)return;const o=h.warning({title:g("chat.exportImage"),content:g("chat.exportImageConfirm"),positiveText:g("common.yes"),negativeText:g("common.no"),onPositiveClick:async()=>{try{o.loading=!0;const d=document.getElementById("image-wrapper"),S=(await ze(d,{useCORS:!0})).toDataURL("image/png"),f=document.createElement("a");f.style.display="none",f.href=S,f.setAttribute("download","chat-shot.png"),typeof f.download>"u"&&f.setAttribute("target","_blank"),document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(S),o.loading=!1,s.success(g("chat.exportSuccess")),Promise.resolve()}catch{s.error(g("chat.exportFailed"))}finally{o.loading=!1}}})}function be(o){n.value||h.warning({title:g("chat.deleteMessage"),content:g("chat.deleteMessageConfirm"),positiveText:g("common.yes"),negativeText:g("common.no"),onPositiveClick:()=>{c.deleteChatByUuid(+p,o)}})}function ke(){n.value||h.warning({title:g("chat.clearChat"),content:g("chat.clearChatConfirm"),positiveText:g("common.yes"),negativeText:g("common.no"),onPositiveClick:()=>{c.clearChatByUuid(+p)}})}function Te(o){y.value?o.key==="Enter"&&o.ctrlKey&&(o.preventDefault(),ie()):o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),ie())}function Se(){n.value&&(r.abort(),n.value=!1)}const $e=I(()=>U.value.startsWith("/")?fe.value.filter(o=>o.key.toLowerCase().includes(U.value.substring(1).toLowerCase())).map(o=>({label:o.value,value:o.value})):[]),Ae=o=>{for(const d of fe.value)if(d.value===o.label)return[d.key];return[]},Re=I(()=>y.value?g("chat.placeholderMobile"):g("chat.placeholder")),Be=I(()=>n.value||!U.value||U.value.trim()===""),Le=I(()=>{let o=["p-4"];return y.value&&(o=["sticky","left-0","bottom-0","right-0","p-2","pr-3","overflow-hidden"]),o});He(()=>{var o;A(),u.value&&!y.value&&((o=u.value)==null||o.focus()),setTimeout(()=>{N()[0].data.length==0&&R(+p,{dateTime:new Date().toLocaleString(),text:"很高兴再次见到你，我是知潮GPT，有什么问题需要解决吗？",inversion:!1,error:!1,conversationOptions:null,requestOptions:{prompt:"eeeeeeeee",options:null}})},100)}),Je(()=>{n.value&&r.abort()});function Ue(){ne.value=!1}function Ie(){return x.value.isLogin?!0:N()[0].data.length>=4?(console.log("login"),ne.value=!0,!1):!0}return(o,d)=>(m(),D("div",Bt,[e(y)?(m(),P(xt,{key:0,"using-context":e(G),onExport:pe,onToggleUsingContext:e(E)},null,8,["using-context","onToggleUsingContext"])):q("",!0),a("main",Lt,[a("div",{id:"scrollRef",ref_key:"scrollRef",ref:J,class:"h-full overflow-hidden overflow-y-auto"},[a("div",{id:"image-wrapper",class:Z(["w-full max-w-screen-xl m-auto",[e(y)?"p-2":"p-4"]])},[e(T).length?(m(),D("div",Ot,[(m(!0),D(Q,null,We(e(T),(_,S)=>(m(),P(e(ct),{key:S,"date-time":_.dateTime,text:_.text,inversion:_.inversion,error:_.error,loading:_.loading,"show-too-long":_.showTooLong,onRegenerate:f=>_e(S),onDelete:f=>be(S)},null,8,["date-time","text","inversion","error","loading","show-too-long","onRegenerate","onDelete"]))),128)),a("div",Dt,[n.value?(m(),P(e(ee),{key:0,type:"warning",onClick:Se},{icon:C(()=>[l(e(O),{icon:"ri:stop-circle-line"})]),default:C(()=>[L(" Stop Responding ")]),_:1})):q("",!0)])])):(m(),D("div",Ut,[l(e(O),{icon:"ri:bubble-chart-fill",class:"mr-2 text-3xl"}),It]))],2)],512)]),a("footer",{class:Z(e(Le))},[a("div",zt,[a("div",Pt,[l(e(se),{onClick:ke},{default:C(()=>[a("span",Et,[l(e(O),{icon:"carbon:clean"})])]),_:1}),e(y)?q("",!0):(m(),P(e(se),{key:0,onClick:pe},{default:C(()=>[a("span",Mt,[l(e(O),{icon:"ri:download-2-line"})])]),_:1})),l(e(et),{value:U.value,"onUpdate:value":d[1]||(d[1]=_=>U.value=_),options:e($e),"render-label":Ae},{default:C(({handleInput:_,handleBlur:S,handleFocus:f})=>[l(e(j),{ref_key:"inputRef",ref:u,value:U.value,"onUpdate:value":d[0]||(d[0]=K=>U.value=K),style:{padding:"5px"},type:"textarea",placeholder:e(Re),autosize:{minRows:1,maxRows:e(y)?4:8},onInput:_,onFocus:f,onBlur:S,onKeypress:Te},null,8,["value","placeholder","autosize","onInput","onFocus","onBlur"])]),_:1},8,["value","options"]),l(e(ee),{id:"sendButton",type:"primary",style:{padding:"21px 12px","border-radius":"21px"},onClick:ie},{icon:C(()=>[a("span",Nt,[l(e(O),{icon:"ri:send-plane-fill"})])]),_:1}),l(Rt,{visible:ne.value,onCanClose:Ue},null,8,["visible"])])])],2)]))}});const Jt=Object.freeze(Object.defineProperty({__proto__:null,default:Zt},Symbol.toStringTag,{value:"Module"}));export{lt as c,Jt as i};
